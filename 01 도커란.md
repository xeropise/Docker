## 01 도커란?

- 리눅스 컨테이너에 여러 기능을 추가함으로써 애플리케이션을 컨테이너로서 좀더 쉽게 사용할 수 있게 만들어진 오픈소스 프로젝트

- Go 언어로 작성, 2013년 3월 첫 번쨰 발표 이후 꾸준히 개발되고 있음

- 기존에 쓰이던 <U>가상 머신</U>과 달리 도커 컨테이너는 성능의 손실이 거의 없어 차세대 클라운드 인프라 솔루션으로 주목 받고 있다.

#### **가상 머신(Virtual Machine, MV)??**

> - 실제하는 컴퓨터 상에 소프트웨어로 논리적으로 만들어낸 컴퓨터
> - 하나의 물리 자원(컴퓨터) 위에 하나의 환경(OS)만 있는 것을 효율화하고자 가상화층을 만들고 그 위에 OS를 새로 설치하는 기법

<br>

- 일반적으로 도커라고 하면 도커 엔진(Docker Engine) 혹은 도커에 관련된 모든 프로젝트를 의미한다. 보통 도커 엔진이라는 의미로 더 많이 쓰이는데 도커 엔진은 컨테이너를 생성하고 관리하는 주체로서 이 자체로도 컨테이너를 제어할 수 있고 다양한 기능을 제공하는 도커의 주 프로젝트이기 때문이다.

- 핵심은 도커 엔진, 다른 여러 프로젝트들은 도커 엔진을 좀 더 효율적으로 사용하기 위한 것에 불과하다.

- 도커 컨테이너를 다루기 위한 가장 기본적인 도커 엔진을 사용하는 방법을 알아 보자.

---

### **1.1 가상 머신과 도커 컨테이너**

- 기존의 가상화 기술 -> <U>하이퍼바이저</U>를 이용해 여러 개의 운영체제를 하나의 호스트에서 생성해 사용하는 방식

#### **[하이퍼 바이저??](https://www.redhat.com/ko/topics/virtualization/what-is-a-hypervisor)**

> 가상 머신을 생성하고 구동하는 소프트웨어

- 여러 개의 운영체제는 가상 머신이라는 단위로 구별, 각 가상 머신에는 우분투(Ubuntu), CentOS 등의 운영체제가 설치되어 사용된다.

- 하이퍼바이저에 의해 생성되고 관리되는 운영체제는 게스트 운영체제(Guest OS)라고 하며, 각 게스트 운영체제는 다른 게스트 운영체제와는 완전히 독립된 공간과 시스템 자원을 할당받아 사용한다. 이러한 가상화 방식을 사용할 수 있는 대표적인 가상화 툴로 VirtualBox, VMware 등이 있다.

![vm](https://user-images.githubusercontent.com/50399804/120408831-c7cdf980-c38a-11eb-884c-337f8bbd3315.png)

- 각종 시스템 자원을 가상화하고 독립된 공간을 생성하는 작업은 하이퍼바이저를 반드시 거치기 떄문에 일반 호스트에 비해 성능의 손실이 발생한다. 뿐만 아니라 가상 머신은 게스트 운영체제를 사용하기 위한 라이브러리, 커널 등을 전부 포함하기 때문에 가상 머신을 배포하기 위한 이미지로 만들었을 때 이미지의 크기 또한 커진다.

- 즉, **가상 머신은 완벽한 운영체제를 생성할 수 있다는 장점은 있지만 일반 호스트에 비해 성능 송실이 있고, 수 기가바이트에 달하는 가상 머신 이미지를 애플리케이션으로 배포하기는 부담스럽다는 단점이 있다.**

- 이에 비해 **도커 컨테이너는 가상화된 공간을 생성하기 위해 리눅스의 자체 기능인 chroot, 네임스페이스(namespace), cgroup 을 사용함으로써 프로세스 단위의 격리 환경을 만들기 때문에 성능 손실이 거의 없다.**

![docker](https://user-images.githubusercontent.com/50399804/120409135-4a56b900-c38b-11eb-9778-d0e03d8f4d56.png)

- 컨테이너에 필요한 커널은 호스트의 커널을 공유해 사용하고, 컨테이너 안에는 애플리케이션을 구동하는 데 필요한 라이브러리 및 실행 파일만 존재하기 때문에 컨테이너를 이미지로 만들었을 때 이미지의 용량 또한 가상 머신에 비해 대폭 줄어든다.

- 따라서 컨테이너를 이미지로 만들어 배포하는 시간이 가상 머신에 비해 빠르고, 가상화된 공간을 사용할 떄 성능 손실도 거의 없다.

---

### 1.2 도커를 시작해야 하는 이유?

- 컨테이너는 여러 가지 종류가 존재(OpenVZ, LXC, cri-o) 하지만, 그 중에서도 도커는 컨테이너 생태계에서 사실상 표준으로 사용되고 있다. 쿠버네티스, 메소스와 같은 오픈소스 프로젝트에서도 도커를 기준으로 개발되고 있으며, 점점 많은 회사들이 서비스 개발 및 운영 환경에 도커 컨테이너를 도입하고 있다.

#### 1.2.1 애플리케이션의 개발과 배포가 편해진다.

- 서버를 부팅할 떄 실행되는 운영체제를 일반적으로 '호스트 OS'라고 부르며, 도커 컨테이너는 호스트 OS 위에서 실행되는 격리된 공간. 따라서 컨테이너 자체에 특별한 권한을 주지 않는 한, 컨테이너 내부에서 수많은 소프트웨어를 설치하고 설정 파일을 수정해도 호스트 OS 에는 영향을 끼치지 않는다. 즉, 독립된 개발 환경을 보장받을 수 있다.

- 컨테이너 내부에서 여러 작업을 한 뒤, 운영 환경에 배포하려고 하면, 컨테이너를 '도커 이미지' 라고 하는 일종의 패키지로 만들어 운영 서버에 전달하기만 하면 된다.

- 컨테이너에서 사용되던 운영 서버에서 새롭게 패키지를 설치할 필요도 없고, 각종 라이브러리 설치 등으로 인한 의존성을 걱정할 필요도 없다. 서비스를 개발했을 때 사용했던 환경을 다른 서버에서도 컨테이너로서 똑같이 복제할 수 있기 때문에 개발/운영 환경의 통합이 가능해진다.

- 게다가 도커 이미지는 가상 머신의 이미지와 달리 커널을 포함하고 있지 않기 때문에 이미지 크기가 그다지 크지 않다. 또한 도커는 이미지 내용을 레이어 단위로 구성하며, 중복되는 레이어를 재사용할 수 있어서 애플리케이션 배포 속도가 매우 빨라진다는 장점이 있다.

[커널이란?](https://5equal0.tistory.com/entry/Linux-Kernel-%EC%BB%A4%EB%84%90%EC%9D%98-%EA%B0%9C%EB%85%90%EA%B3%BC-%EC%BB%A4%EB%84%90%EC%9D%98-%EA%B5%AC%EC%A1%B0)

<br>

#### 1.2.2 여러 애플리케이션의 독립성과 확장성이 높아진다.

- 소프트웨어의 여러 모듈이 상호 작용하는 로직을 하나의 프로그램 내에서 구동시키는 방식을 모놀리스(Monolith) 애플리케이션이라고 한다. 소규모 서비스에서는 이 방식이 어울릴지도 모르지만, 서비스의 기능이 복잡해지고 거대해질수록 소프트웨어 자체의 확장성과 유연성이 줄어든다는 단점이 있다. 이러한 모놀리스 방식을 대체하기 위해 최근 새롭게 떠오른 개념이 바로 마이크로서비스(Microservices) 구조이다.

![img](https://user-images.githubusercontent.com/50399804/120409869-d1f0f780-c38c-11eb-99d6-39d02d03f5c1.png)

- 마이크로서비스 구조는 여러 모듈을 독립된 형태로 구성하기 때문에 언어에 종속되지 않고 변화에 빠르게 대응할 수 있어, 각 모듈의 관리가 쉬워진다는 장점이 있다. 컨테이너는 수 초 내로 생성, 시작이 가능할 뿐만 아니라 여러 모듈에게 독립도니 환경을 동시에 제공할 수 있기 때문에 마이크로서비스 구조에서 가장 많이 사용되고 있는 가상화 기술이다.

---

### 1.3 도커 엔진 설치

#### 1.3.2 리눅스 도커 엔진 설치

- 리눅스에서 도커를 설치할 때 확인해야할 사항이 있다.

  - 최신 버전 커널을 사용하고 있는지, 호스트 운영체제가 최소한 3.10 버전 이상을 사용해야 도커 컨테이너를 정상적으로 사용할 수 있다. 터미널에서 uname -r 명령어를 입력해 커널의 버전이 맞는지 확인하자.

  ```
  # uname - r
  ```

  - 지원 기간 내에 있는 배포판인지 확인하자. 오래된 리눅스 배포판은 업데이트 등의 지원을 받지 못한다. 리눅스 운영체제의 공식 웹사이트에서 확인 가능하다.

  - 64비트 리눅스인지 확인하자. 도커는 64비트에 최적화되어 있다. 32비트 버전에서 도커를 실행하는 방법이 없는 것은 아니나 권장하지 않는다.

  - sudo 명령어를 통해 설치하거나 root 권한을 소유한 계정에서 설치를 진행해야 한다.

- 위 조건을 모두 만족하면 도커 설치를 진행해보자.

**우분투 14.04, 16.04, 18.04**

```
# curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -

# add-apy-repository \
 "deb [arch=amd64] https://download.docker.com/lunux/ubuntu $(lsb_release -cs) stable"

# apt-get update

# apt-get install docker-ce
```

**CentOS 7, RHEL7**

```
# yum install -y yum-utils
# yum-config-manager \
--add-respo \
https://download.docker/com/linux/centos/docker-ce.repo
# yum install -y docker-ce
# systemctl start docker
```

- 어떤 운영체제를 사용 중인지 잘 모르거나 도커 설치 방법을 찾을 수 없는 경우 도커에서 제공하는 설치 스크립트로 손쉽게 설치할 수 있다. 대부분 리눅스 운영체제에서 사용할 수 있는 간단한 방법이나 웹에서 신뢰할 수 없는 쉘 스크립트르 받아 실행하는 것은 좋은 습관이 아니다.

```
# wget -q0- get.docker.com | sh
```

- 설치가 완료된 후 도커가 정상적으로 동작하는지 확인하려면 docker info 명령어를 입력하자. docker info는 설치된 도커 엔진의 각종 정보를 출력하는 명렁어다. 도커 엔진이 설치됐음을 알 수 있다. 최신 버전의 도커 엔진은 새로운 기능을 사용할 수 있지만, 안정화가 되어 있지 않으니 주의하자.

```
# docker info
```

#### 1.3.3 윈도우, 맥 OS에 설치

- 도커의 기능을 완전하게 사용하려면 리눅스에서 사용하는 것이 가장 바람직하지만, 윈도우와 맥 OS X에서도 간단한 테스트나 개발 용도로 사용할 수 있다. 리눅스를 사용할 수 있는 환경일면 리눅스를 사용하는 것이 좋다.

- 원래 윈도우와 맥 OS X에서 도커를 사용하려면 도커 툴박스(Docker Toolbox)라는 패키지를 설치해야 했다. 도커 툴박스는 오라클 버추얼박스(VirtualBox)의 가상화 기술을 이용해 리눅스 가상 환경을 구축한 뒤 도커를 설치했다.

- 그러나 최근에는 각 운영체제의 자체 가상화 기술을 사용한 도커가 출시되어 버추얼박스에 의존하지 않고도 도커를 설치할 수 있다. (Docker for Windows, Docker for Mac OS X)

- 도커 툴박스와 자체 가상화 도커는 요구하는 운영체제 사양이 다르므로 사양에 따라 설치하여야 한다. 단 윈도우에서 도커 툴박스와 자체 가상화 도커를 둘 다 설치할 경우, 오류가 발생하므로 둘 중하나만 설치하는 것이 좋다.

<br>

##### 1.3.3.1 도커 툴박스 설치 하지만 Deprecated.. 도커 Desktop

- 윈도우와 맥 OS X 에서 도커 툴박스를 설치하기 위해 다음의 사양을 확인해야 한다.

|          | 윈도우               | 맥 OS X                       |
| -------- | -------------------- | ----------------------------- |
| 운영체제 | 윈도우 7 64비트 이상 | OS X 10.8 mountain Lione 이상 |
| 하드웨어 | CPU가 가상화를 지원  | 테스트3                       |

- 아래 URL에서 도커 툴박스를 내려받아 설치하자.

```
맥 OS : https://docs.docker.com/toolbox/toolbox_install_mac/
윈도우 : https://docs.docker.com/toolbox/toolbox_install_windows/
```

- 근데 도커 툴박스가 Deprecated 가 되었고, Docker Desktop 을 설치해야 한다.

```
맥 OS : https://docs.docker.com/docker-for-mac/
윈도우 : https://docs.docker.com/docker-for-windows/install/
```

![캡처](https://user-images.githubusercontent.com/50399804/120421675-ad534a80-c3a1-11eb-9c09-52d378f0f539.JPG)

- 도커 데스크탑은 도커 엔진, 도커 CLI client, 도커 Compose, Notary, Kuberaneted 그리고 Credential Helper 를 포함하고 있다.

- CPU가 가상화를 지원해야 도커를 설치할 수 잇는데, 작업 관리자를 실행하여 가상화가 활성화되어 있는지 확인하자.

![캡처](https://user-images.githubusercontent.com/50399804/120424542-8d268a00-c3a7-11eb-907c-3feae5b8ce4b.JPG)

- Windows Home 버전은 Hyper-V 를 지원하지 않기 때문에 WSL2 를 설치해야 한다.

[Hyper-v?](https://namu.wiki/w/Hyper-V)
[WSL?](https://ko.wikipedia.org/wiki/%EB%A6%AC%EB%88%85%EC%8A%A4%EC%9A%A9_%EC%9C%88%EB%8F%84%EC%9A%B0_%ED%95%98%EC%9C%84_%EC%8B%9C%EC%8A%A4%ED%85%9C)

- 나머지 부분은 생략한다. 필요할 때 찾아보자.

![캡처](https://user-images.githubusercontent.com/50399804/120427621-2d32e200-c3ad-11eb-8cac-6d0a30236b09.JPG)
